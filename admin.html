<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dashboard Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .tab-content > div { display: none; }
    .tab-content > .active { display: block; }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h2>üìä Admin Dashboard</h2>
    <ul class="nav nav-tabs mt-4" id="adminTabs">
      <li class="nav-item">
        <a class="nav-link active" href="#products" onclick="switchTab('products')">S·∫£n ph·∫©m</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#users" onclick="switchTab('users')">Ng∆∞·ªùi d√πng</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#orders" onclick="switchTab('orders')">ƒê∆°n h√†ng</a>
      </li>
    </ul>

    <div class="tab-content mt-4">
      <!-- Products Tab -->
      <div id="products" class="active">
        <h4>üõç Qu·∫£n l√Ω s·∫£n ph·∫©m</h4>
        <button class="btn btn-primary mb-2" onclick="showProductForm()">+ Th√™m s·∫£n ph·∫©m</button>
        <table class="table table-bordered">
          <thead><tr><th>ID</th><th>T√™n</th><th>Gi√°</th><th>M√¥ t·∫£</th><th>H√†nh ƒë·ªông</th></tr></thead>
          <tbody id="productTable"></tbody>
        </table>
      </div>

      <!-- Users Tab -->
      <div id="users">
        <h4>üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h4>
        <button class="btn btn-primary mb-2" onclick="showUserForm()">+ Th√™m ng∆∞·ªùi d√πng</button>
        <table class="table table-bordered">
          <thead><tr><th>ID</th><th>H·ªç t√™n</th><th>Email</th><th>Vai tr√≤</th><th>H√†nh ƒë·ªông</th></tr></thead>
          <tbody id="userTable"></tbody>
        </table>
      </div>

      <!-- Orders Tab -->
      <div id="orders">
        <h4>üì¶ Qu·∫£n l√Ω ƒë∆°n h√†ng</h4>
        <table class="table table-bordered">
          <thead><tr><th>ID</th><th>Ng∆∞·ªùi d√πng</th><th>T·ªïng ti·ªÅn</th><th>Th·ªùi gian</th><th>Tr·∫°ng th√°i</th></tr></thead>
          <tbody id="orderTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal/Form product -->
  <div class="modal" tabindex="-1" id="productModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Th√™m s·∫£n ph·∫©m</h5></div>
        <div class="modal-body">
          <input type="hidden" id="productId">
          <input type="text" id="productName" class="form-control mb-2" placeholder="T√™n s·∫£n ph·∫©m">
          <input type="number" id="productPrice" class="form-control mb-2" placeholder="Gi√°">
          <input type="text" id="productDescription" class="form-control mb-2" placeholder="M√¥ t·∫£">
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="hideProductForm()">H·ªßy</button>
          <button class="btn btn-success" onclick="submitProduct()">L∆∞u</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal/Form user -->
  <div class="modal" tabindex="-1" id="userModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Th√™m ng∆∞·ªùi d√πng</h5></div>
        <div class="modal-body">
          <input type="hidden" id="userId">
          <input type="text" id="userName" class="form-control mb-2" placeholder="T√™n">
          <input type="email" id="userEmail" class="form-control mb-2" placeholder="Email">
          <input type="text" id="userRole" class="form-control mb-2" placeholder="Vai tr√≤ (USER/ADMIN)">
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="hideUserForm()">H·ªßy</button>
          <button class="btn btn-success" onclick="submitUser()">L∆∞u</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const role = localStorage.getItem("role");
    if (role !== "ADMIN") {
      alert("‚ùå Truy c·∫≠p b·ªã t·ª´ ch·ªëi. Ch·ªâ ADMIN m·ªõi ƒë∆∞·ª£c v√†o.");
      window.location.href = "/java-project-shop-fe/admin";
    }

    function switchTab(tabId) {
      document.querySelectorAll('.tab-content > div').forEach(div => div.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      document.querySelector(`a[href='#${tabId}']`).classList.add('active');

      if (tabId === 'users') loadUsers();
      if (tabId === 'orders') loadOrders();
    }

    function showProductForm(product = null) {
      document.getElementById('productModal').style.display = 'block';
      if (product) {
        document.getElementById('productId').value = product.id;
        document.getElementById('productName').value = product.name;
        document.getElementById('productPrice').value = product.price;
        document.getElementById('productDescription').value = product.description;
      } else {
        document.getElementById('productId').value = '';
        document.getElementById('productName').value = '';
        document.getElementById('productPrice').value = '';
        document.getElementById('productDescription').value = '';
      }
    }

    function hideProductForm() {
      document.getElementById('productModal').style.display = 'none';
    }

    function submitProduct() {
      const id = document.getElementById('productId').value;
      const name = document.getElementById('productName').value;
      const price = document.getElementById('productPrice').value;
      const description = document.getElementById('productDescription').value;

      const product = { name, price, description };
      const url = id ? `https://code-web-mufd.onrender.com/product/update/${id}` : 'https://code-web-mufd.onrender.com/product/create';
      const method = id ? 'PUT' : 'POST';

      fetch(url, {
        method: method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(product)
      }).then(() => {
        hideProductForm();
        loadProducts();
      });
    }

    function deleteProduct(id) {
      if (confirm("X√°c nh·∫≠n x√≥a s·∫£n ph·∫©m?")) {
        fetch(`https://code-web-mufd.onrender.com/product/delete/${id}`, { method: 'DELETE' })
          .then(() => loadProducts());
      }
    }

    function showUserForm(user = null) {
      document.getElementById('userModal').style.display = 'block';
      if (user) {
        document.getElementById('userId').value = user.id;
        document.getElementById('userName').value = user.name;
        document.getElementById('userEmail').value = user.email;
        document.getElementById('userRole').value = user.role;
      } else {
        document.getElementById('userId').value = '';
        document.getElementById('userName').value = '';
        document.getElementById('userEmail').value = '';
        document.getElementById('userRole').value = '';
      }
    }

    function hideUserForm() {
      document.getElementById('userModal').style.display = 'none';
    }

    function submitUser() {
      const id = document.getElementById('userId').value;
      const name = document.getElementById('userName').value;
      const email = document.getElementById('userEmail').value;
      const role = document.getElementById('userRole').value;

      const user = { name, email, role };
      const url = id ? `https://code-web-mufd.onrender.com/user/update/${id}` : 'https://code-web-mufd.onrender.com/user/create';
      const method = id ? 'PUT' : 'POST';

      fetch(url, {
        method: method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(user)
      }).then(() => {
        hideUserForm();
        loadUsers();
      });
    }

    function deleteUser(id) {
      if (confirm("X√°c nh·∫≠n x√≥a ng∆∞·ªùi d√πng?")) {
        fetch(`https://code-web-mufd.onrender.com/user/delete/${id}`, { method: 'DELETE' })
          .then(() => loadUsers());
      }
    }

    function loadProducts() {
      fetch('https://code-web-mufd.onrender.com/product/search')
        .then(res => res.json())
        .then(data => {
          const table = document.getElementById("productTable");
          table.innerHTML = "";
          data.forEach(p => {
            const row = `<tr>
              <td>${p.id}</td>
              <td>${p.name}</td>
              <td>${p.price}</td>
              <td>${p.description}</td>
              <td>
                <button class='btn btn-sm btn-warning' onclick='showProductForm(${JSON.stringify(p)})'>S·ª≠a</button>
                <button class='btn btn-sm btn-danger' onclick='deleteProduct(${p.id})'>X√≥a</button>
              </td>
            </tr>`;
            table.innerHTML += row;
          });
        });
    }

    function loadUsers() {
      fetch('https://code-web-mufd.onrender.com/user/search')
        .then(res => res.json())
        .then(data => {
          const table = document.getElementById("userTable");
          table.innerHTML = "";
          data.forEach(u => {
            const row = `<tr>
              <td>${u.id}</td>
              <td>${u.name}</td>
              <td>${u.email}</td>
              <td>${u.role}</td>
              <td>
                <button class='btn btn-sm btn-warning' onclick='showUserForm(${JSON.stringify(u)})'>S·ª≠a</button>
                <button class='btn btn-sm btn-danger' onclick='deleteUser(${u.id})'>X√≥a</button>
              </td>
            </tr>`;
            table.innerHTML += row;
          });
        });
    }

    function loadOrders() {
      fetch('https://code-web-mufd.onrender.com/order/search')
        .then(res => res.json())
        .then(data => {
          const table = document.getElementById("orderTable");
          table.innerHTML = "";
          data.forEach(o => {
            const row = `<tr>
              <td>${o.id}</td>
              <td>${o.userId}</td>
              <td>${o.amount.toLocaleString()}ƒë</td>
              <td>${o.transTime}</td>
              <td>${o.status === 1 ? 'ƒê√£ thanh to√°n' : 'Ch∆∞a thanh to√°n'}</td>
            </tr>`;
            table.innerHTML += row;
          });
        });
    }

    loadProducts();
  </script>
</body>
</html>
